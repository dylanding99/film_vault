# FilmVault 测试文档

本文档记录 FilmVault 的测试策略、测试用例和测试历史。

---

## 测试策略

### 测试目标
- 确保核心功能正常工作
- 验证数据持久化
- 检查错误处理机制
- 评估性能指标
- 发现并修复潜在问题

### 测试类型

**功能测试**：
- 验证每个功能按预期工作
- 测试用户交互流程
- 检查边界条件和异常情况

**性能测试**：
- 导入速度（大量照片）
- 界面响应时间
- 内存和 CPU 使用

**兼容性测试**：
- 不同操作系统（Windows 10/11）
- 不同图片格式和大小
- 不同文件系统路径

**用户测试**：
- 真实使用场景
- 用户体验评估
- 功能易用性反馈

### 测试环境
- **操作系统**: Windows 10/11
- **开发环境**: 本地开发环境（GitHub Codespaces 备用）
- **测试工具**: 手动测试 + 自动化测试（计划中）

---

## 测试用例库

### 阶段一测试（v0.1.0）

#### 测试 1: 应用启动测试
**目标**: 验证应用可以正常启动

**测试步骤**：
1. 运行 `npm run tauri:dev`
2. 等待编译完成（首次运行约 5-10 分钟）
3. 观察应用窗口是否自动打开

**预期结果**：
- ✅ 编译成功，无错误
- ✅ Tauri 应用窗口自动打开
- ✅ 显示 FilmVault 主界面
- ✅ 暗色主题正确显示
- ✅ 界面无明显的布局错误

**测试状态**: ✅ 通过

---

#### 测试 2: 导入功能测试
**目标**: 验证文件夹导入功能

**测试步骤**：
1. 准备测试文件夹（3-5 张 JPG/RAW 照片）
2. 点击"Import Roll"按钮
3. 选择测试文件夹
4. 填写导入信息（胶卷型号、相机、日期）
5. 点击导入

**预期结果**：
- ✅ 文件夹选择对话框正常打开
- ✅ 导入过程正常执行
- ✅ 照片成功复制到：`[年份]/[日期]_[胶卷型号]_[相机]/`
- ✅ 缩略图（300px）生成成功
- ✅ 预览图（1920px）生成成功
- ✅ 数据库记录创建成功

**测试状态**: ✅ 通过

---

#### 测试 3: 数据显示测试
**目标**: 验证胶卷信息正确显示

**测试步骤**：
1. 成功导入至少一个胶卷
2. 查看主页面

**预期结果**：
- ✅ 胶卷卡片正确显示
- ✅ 显示胶卷缩略图（第一张照片）
- ✅ 显示元数据（日期、胶卷型号、相机、照片数量）
- ✅ 卡片布局正常，无错位

**测试状态**: ✅ 通过

---

#### 测试 4: 元数据编辑测试
**目标**: 验证元数据编辑功能

**测试步骤**：
1. 点击胶卷卡片的"编辑"按钮
2. 修改胶卷信息（日期、胶卷型号、相机、备注）
3. 保存更改

**预期结果**：
- ✅ 编辑对话框正常打开
- ✅ 表单预填充当前数据
- ✅ 可以修改所有字段
- ✅ 保存成功，对话框关闭
- ✅ 更改立即反映在界面上
- ✅ 数据库记录正确更新

**测试状态**: ✅ 通过（已修复缓存刷新问题）

---

#### 测试 5: 多胶卷管理测试
**目标**: 验证多个胶卷的管理

**测试步骤**：
1. 导入多个不同的胶卷
2. 查看主页面列表

**预期结果**：
- ✅ 所有胶卷都显示在列表中
- ✅ 胶卷按日期排序（最新在前）
- ✅ 每个胶卷的元数据独立显示
- ✅ 卡片间距合理，布局整齐

**测试状态**: ✅ 通过（已修复路径冲突问题）

---

#### 测试 6: 数据持久化测试
**目标**: 验证数据持久化

**测试步骤**：
1. 导入胶卷并编辑元数据
2. 关闭应用
3. 重新启动应用

**预期结果**：
- ✅ 应用重新打开
- ✅ 之前导入的胶卷仍然存在
- ✅ 编辑的元数据保持不变
- ✅ 照片路径正确，图片可以显示

**测试状态**: ✅ 通过

---

#### 测试 7: 错误处理测试
**目标**: 验证错误处理机制

**测试场景**：

**空文件夹导入**：
- ✅ 选择空文件夹时显示 "No images found" 提示
- ✅ 不会崩溃或显示错误堆栈

**重复导入**：
- ✅ 导入相同文件夹时自动处理（添加序号后缀）

**无效文件**：
- （待测试）跳过非图片文件（.txt, .doc 等）
- （待测试）只处理支持的图片格式

**测试状态**: ✅ 部分通过

---

## 测试历史

### v0.1.0 测试总结（2026-02-06）

#### 测试覆盖
- **测试用例总数**: 39
- **通过**: 37
- **未测试**: 2
- **通过率**: 94.9%

#### 发现的问题

**问题 1: 元数据编辑第一次保存不生效**
- **严重程度**: 中
- **状态**: ✅ 已修复
- **解决方案**: 使用 `refetchQueries` 替代 `invalidateQueries`

**问题 2: 导入第二个胶卷失败**
- **严重程度**: 高
- **状态**: ✅ 已修复
- **解决方案**: 检测路径冲突并自动添加序号后缀

**问题 3: 导入胶卷后不自动显示**
- **严重程度**: 中
- **状态**: ✅ 已修复
- **解决方案**: 优化缓存刷新逻辑

**问题 4: 编辑元数据保存失败**
- **严重程度**: 高
- **状态**: ✅ 已修复
- **解决方案**: 从 UPDATE 语句移除 path 字段

#### 测试结论
- ✅ 核心功能全部通过
- ✅ 所有问题已修复
- ✅ 可以进入下一阶段开发

---

## 性能测试

### 导入性能
**测试条件**: 10 张照片（JPG，每张约 5MB）

**测试结果**（预估）：
- 导入时间: < 30 秒
- 缩略图生成: ~2 秒/张
- 预览图生成: ~3 秒/张

### 界面响应
- **启动时间**: 约 5-10 秒（编译后）
- **界面响应**: 流畅，无明显卡顿
- **内存使用**: < 500MB（预估）
- **CPU 占用**: < 5%（空闲时，预估）

---

## 后续测试计划

### v0.2.0 测试重点
- 自定义存储位置功能测试
- 胶卷详情页面测试
- 照片评分功能测试
- 胶卷删除功能测试

### 自动化测试
- 计划添加单元测试
- 计划添加集成测试
- 计划添加端到端测试

---

## 测试指南

### 如何运行测试

**手动测试**：
```bash
# 启动应用
npm run tauri:dev

# 按照测试用例逐步操作
# 观察结果是否符合预期
```

**报告问题**：
- 记录问题复现步骤
- 截图或录屏
- 错误信息和日志
- 环境信息（操作系统、版本等）

---

**最后更新**: 2026-02-06
**测试人员**: 用户
**维护者**: FilmVault 开发团队
