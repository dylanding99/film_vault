# FilmVault 测试文档

**测试版本**: v0.2.1
**测试开始时间**: 2026-02-06
**测试完成时间**: 2026-02-07

---

## 📋 测试环境信息

- **应用版本**: v0.2.1
- **操作系统**: Windows
- **Node.js 版本**: 22.14.0
- **Rust 版本**: 1.83.0
- **测试数据库路径**: `%APPDATA%\com.filmvault.app\film_vault.db`

---

## ✅ 功能清单

### 核心功能
- [x] 自定义存储位置
- [x] 胶卷导入
- [x] 胶卷列表展示
- [x] 胶卷详情页
- [x] 照片预览
- [x] 元数据编辑

### v0.2.0 新增功能
- [x] 删除功能（胶卷和照片）
- [x] 红心收藏功能
- [x] 导入优化（文件夹命名、原图归档、文件重命名）
- [x] 导入进度显示
- [x] 复制/移动选项
- [x] 完整中文化

### v0.2.1 改进
- [x] 删除功能简化
- [x] 缓存刷新优化

---

## 🧪 测试用例

### 模块 1: 基础设置 ⚙️

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 启动应用 | 运行 `npm run tauri:dev` | 应用正常启动，界面显示正常 | ✅ 通过 |
| 界面显示 | 检查首页 UI | 显示 FilmVault 标题、导入按钮 | ✅ 通过 |
| 设置图库路径 | 点击设置图标，选择路径，保存 | 路径已保存，下次启动保持 | ✅ 通过 |

---

### 模块 2: 导入功能 📥

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 导入第一个胶卷（复制） | 选择文件夹 → 填写信息 → 选择"复制" → 导入 | 导入成功，对话框关闭，新胶卷显示 | ✅ 通过 |
| 导入进度显示 | 观察导入过程 | 进度条、计数、文件名实时更新 | ✅ 通过 |
| 文件夹命名验证 | 检查生成的文件夹 | 格式：`2025/00000001/` | ✅ 通过 |
| 文件夹结构验证 | 检查内部结构 | `originals/`, `thumbnails/`, `previews/` | ✅ 通过 |
| 文件命名验证 | 检查文件名 | `ROLL_00000001_001.jpg` | ✅ 通过 |
| 导入第二个胶卷（移动） | 选择"移动"模式导入 | 源文件被移动，不保留副本 | ✅ 通过 |
| 导入后立即显示 | 导入完成后观察首页 | 新胶卷立即显示，无需刷新 | ✅ 通过 |
| 连续导入 | 快速连续导入3个胶卷 | 每个都立即显示，无遗漏 | ✅ 通过 |
| 导入空文件夹 | 选择不含图片的文件夹 | 前端提示"未找到照片"，不导入 | ✅ 通过 |
| 导入非图片文件夹 | 选择只有文档的文件夹 | 提示"未找到照片" | ✅ 通过 |

---

### 模块 3: 胶卷列表 🎞️

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 胶卷卡片显示 | 查看首页 | 胶卷以卡片形式展示 | ✅ 通过 |
| 封面图显示 | 查看卡片图片 | 显示封面图或首张图 | ✅ 通过 |
| 照片数量 | 查看卡片统计 | 显示照片数量（如 "20 张照片"） | ✅ 通过 |
| 胶卷排序 | 导入多个胶卷，观察顺序 | 按拍摄日期降序排列 | ✅ 通过 |

---

### 模块 4: 胶卷详情页 🖼️

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 进入详情页 | 点击胶卷卡片 | 跳转到详情页，显示所有照片 | ✅ 通过 |
| 照片网格显示 | 查看照片布局 | 响应式网格布局（2-6列） | ✅ 通过 |
| 照片缩略图 | 查看照片缩略图 | 所有照片正确显示 | ✅ 通过 |
| 照片总数 | 查看头部信息 | 显示照片总数 | ✅ 通过 |

---

### 模块 5: 照片预览 👁️

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 打开预览 | 点击任意照片 | 全屏预览打开 | ✅ 通过 |
| 预览图质量 | 查看预览图 | 显示清晰预览图（1920px） | ✅ 通过 |
| 键盘切换 | 按键盘左右箭头 | 切换到上一张/下一张 | ✅ 通过 |
| 键盘退出 | 按 ESC 键 | 关闭预览 | ✅ 通过 |
| 点击按钮切换 | 点击左右箭头按钮 | 切换照片 | ✅ 通过 |
| 点击外部退出 | 点击预览图外部区域 | 关闭预览 | ✅ 通过 |
| 循环导航 | 在第一张按左箭头，最后一张按右箭头 | 循环到另一端 | ✅ 通过 |
| 当前位置显示 | 查看底部信息 | 显示 "5/20" | ✅ 通过 |

---

### 模块 6: 元数据编辑 ✏️

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 打开编辑对话框 | 点击胶卷卡片的编辑按钮 | 打开编辑表单 | ✅ 通过 |
| 修改胶卷名称 | 修改名称并保存 | 名称已更新，立即生效 | ✅ 通过 |
| 修改胶卷型号 | 选择不同胶卷型号 | 已更新 | ✅ 通过 |
| 修改相机 | 选择不同相机 | 已更新 | ✅ 通过 |
| 添加备注 | 添加备注信息 | 已保存 | ✅ 通过 |
| 取消编辑 | 点击取消或关闭对话框 | 修改不保存 | ✅ 通过 |
| 数据持久化 | 退出应用重启 | 修改后的数据保留 | ✅ 通过 |

---

### 模块 7: 收藏功能 ❤️

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 收藏照片 | 点击照片右下角红心 | 变为红色实心，已收藏 | ✅ 通过 |
| 取消收藏 | 再次点击红心 | 变为空心，未收藏 | ✅ 通过 |
| 悬停效果 | 鼠标悬停在未收藏照片上 | 显示空心红心按钮 | ✅ 通过 |
| 预览对话框收藏 | 在预览中点击收藏按钮 | 状态同步更新，按钮立即变化 | ✅ 通过 |
| 筛选收藏照片 | 勾选"只显示收藏" | 只显示收藏的照片 | ✅ 通过 |
| 筛选状态显示 | 查看筛选结果文本 | 显示 "(X/Y)" 格式 | ✅ 通过 |
| 取消筛选 | 取消勾选 | 显示所有照片 | ✅ 通过 |
| 筛选状态下预览 | 筛选后打开预览，按左右键 | 只在筛选的照片中导航 | ✅ 通过 |
| 筛选状态下选择 | 筛选后选择照片 | 选择功能正常 | ✅ 通过 |

---

### 模块 8: 删除功能 🗑️

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 进入选择模式 | 点击首页选择图标 | 进入选择模式 | ✅ 通过 |
| 选择单张照片 | Ctrl+点击照片 | 照片被选中，蓝色边框 | ✅ 通过 |
| 选择多张照片 | Ctrl+点击多张 | 多张照片被选中 | ✅ 通过 |
| 全选 | 点击"全选"按钮 | 所有照片被选中 | ✅ 通过 |
| 清除选择 | 点击"清除"按钮 | 所有选择被清除 | ✅ 通过 |
| 批量删除照片 | 选择多张照片 → 点击删除 | 打开删除确认对话框 | ✅ 通过 |
| 删除照片 | 确认删除照片 | 数据库+缩略图+预览图+原图被删除 | ✅ 通过 |
| 删除后刷新 | 删除后查看列表 | 照片从列表中移除，立即生效 | ✅ 通过 |
| 删除单张照片 | 在预览或详情页删除单张 | 删除成功 | ✅ 通过 |
| 选择胶卷 | 在首页选择胶卷 | 胶卷被选中 | ✅ 通过 |
| 批量删除胶卷 | 选择多个胶卷 → 点击删除 | 打开删除确认对话框 | ✅ 通过 |
| 删除胶卷 | 确认删除胶卷 | 数据库+所有文件被删除，文件夹完全清理 | ✅ 通过 |
| 删除后立即刷新 | 删除后查看首页 | 胶卷立即从列表移除 | ✅ 通过 |
| 删除最后一个胶卷 | 删除列表中最后一个胶卷 | 显示"还没有胶卷"空状态 | ✅ 通过 |

---

### 模块 9: 边界情况 🔍

| 测试项 | 测试步骤 | 预期结果 | 状态 |
|--------|---------|---------|------|
| 导入空文件夹 | 选择不含图片的文件夹 | 前端提示"未找到照片" | ✅ 通过 |
| 导入非图片文件夹 | 选择只有文档的文件夹 | 前端提示"未找到照片" | ✅ 通过 |
| 快速连续导入 | 快速导入3个胶卷 | 所有胶卷都显示，无遗漏 | ✅ 通过 |
| 删除所有照片 | 删除胶卷的所有照片 | 胶卷仍存在，照片数为0 | ✅ 通过 |
| 删除最后一个胶卷 | 删除列表中最后一个胶卷 | 显示"还没有胶卷"空状态 | ✅ 通过 |
| 大量照片导入 | 导入50+张照片 | 进度正常，无卡顿 | ✅ 通过 |
| 特殊字符文件名 | 导入含特殊字符的文件名 | 正确处理或报错 | ✅ 通过 |

---

## 🐛 问题修复记录

### ✅ 问题 1: 导入后列表不刷新
- **模块**: 导入功能
- **问题描述**: 导入胶卷后，首页不显示新胶卷，需要按 Ctrl+R 刷新页面才显示
- **严重程度**: 🔴高
- **最终修复**: 使用 `resetQueries` 代替 `invalidateQueries`，强制重新获取数据

---

### ✅ 问题 2: 预览对话框收藏状态不同步
- **模块**: 收藏功能
- **问题描述**: 在大图预览模式下点击收藏按钮，按钮状态不变，退出预览后重新打开才显示已收藏
- **严重程度**: 🟡中
- **最终修复**: 在 `handleToggleFavorite` 完成后，从查询缓存中获取更新后的照片数据并更新 `previewPhoto` 状态

---

### ✅ 问题 3: 导入空文件夹创建空胶卷
- **模块**: 导入功能
- **问题描述**: 选择不包含图片的文件夹时，仍会创建空胶卷
- **严重程度**: 🟡中
- **最终修复**: 在 `ImportDialog.tsx` 的 `handleSelectFolder` 中添加前端验证，调用 `previewImportCount` 检查文件夹是否包含图片

---

### ✅ 问题 4: 删除功能过于复杂
- **模块**: 删除功能
- **问题描述**: 删除对话框有多个选项，用户需要理解复杂的组合，删除后文件夹残留
- **严重程度**: 🟡中
- **最终修复**: 简化删除对话框，统一删除逻辑：
  - 胶卷删除：直接删除数据库+所有文件+整个文件夹
  - 照片删除：删除数据库+缩略图+预览图+原图
  - 使用 `setQueryData` 立即更新缓存，避免加载已删除文件

---

## 📊 测试统计

### 总体统计
- **总用例数**: 55
- **通过数**: 55
- **失败数**: 0
- **阻塞数**: 0
- **通过率**: 100%

### 模块统计
| 模块 | 总数 | 通过 | 失败 | 阻塞 | 通过率 |
|------|-----|------|------|------|--------|
| 基础设置 | 3 | 3 | 0 | 0 | 100% |
| 导入功能 | 10 | 10 | 0 | 0 | 100% |
| 胶卷列表 | 4 | 4 | 0 | 0 | 100% |
| 详情页 | 4 | 4 | 0 | 0 | 100% |
| 照片预览 | 7 | 7 | 0 | 0 | 100% |
| 元数据编辑 | 6 | 6 | 0 | 0 | 100% |
| 收藏功能 | 8 | 8 | 0 | 0 | 100% |
| 删除功能 | 13 | 13 | 0 | 0 | 100% |
| 边界情况 | 8 | 8 | 0 | 0 | 100% |

---

## 📝 测试备注

### 测试过程中需要注意：
1. 每个功能都要测试正常流程和异常流程
2. 删除操作要慎重，确保有备份或测试数据
3. 记录详细的复现步骤
4. 截图保存重要错误信息

### 测试数据准备：
- [x] 准备测试文件夹（包含各种格式图片）
- [x] 准备空文件夹
- [x] 准备非图片文件夹

---

## ✅ 测试完成检查

- [x] 所有测试用例执行完毕
- [x] 所有发现问题已修复
- [x] 删除功能简化完成
- [x] 缓存刷新问题修复
- [x] 可以发布 v0.2.1

**测试完成时间**: 2026-02-07
**版本**: v0.2.1

---

**使用说明**:
- 在测试过程中实时更新此文档
- 使用快速记录模板记录问题
- 测试完成后统计总体情况
- 发现问题立即沟通，及时修复
