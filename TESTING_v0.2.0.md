# FilmVault v0.2.0 - 测试文档

**测试开始时间**: 2026-02-06
**测试人员**:
**测试环境**: Windows / Tauri v2 / Next.js 15

---

## 📋 测试环境信息

- **应用版本**: v0.2.0
- **操作系统**: Windows
- **Node.js 版本**:
- **Rust 版本**:
- **测试数据库路径**: `%APPDATA%\com.filmvault.app\film_vault.db`

---

## ✅ 功能清单

### 核心功能
- [x] 自定义存储位置
- [x] 胶卷导入
- [x] 胶卷列表展示
- [x] 胶卷详情页
- [x] 照片预览
- [x] 元数据编辑

### v0.2.0 新增功能
- [x] 删除功能（胶卷和照片）
- [x] 红心收藏功能
- [x] 导入优化（文件夹命名、原图归档、文件重命名）
- [x] 导入进度显示
- [x] 复制/移动选项
- [x] 完整中文化

---

## 🧪 测试用例

### 模块 1: 基础设置 ⚙️

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 启动应用 | 运行 `npm run tauri:dev` | 应用正常启动，界面显示正常 | 完成 |正常|
| 界面显示 | 检查首页 UI | 显示 FilmVault 标题、导入按钮 | 完成 |正常|
| 设置图库路径 | 点击设置图标，选择路径，保存 | 路径已保存，下次启动保持 | 完成 |正常|

---

### 模块 2: 导入功能 📥

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 导入第一个胶卷（复制） | 选择文件夹 → 填写信息 → 选择"复制" → 导入 | 导入成功，对话框关闭，新胶卷显示 | 完成 |正常|
| 导入进度显示 | 观察导入过程 | 进度条、计数、文件名实时更新 | 完成 |正常|
| 文件夹命名验证 | 检查生成的文件夹 | 格式：`2025/00000001/` | 完成 |正常|
| 文件夹结构验证 | 检查内部结构 | `originals/`, `thumbnails/`, `previews/` | 完成 |正常|
| 文件命名验证 | 检查文件名 | `ROLL_00000001_001.jpg` | 完成 |正常|
| 导入第二个胶卷（移动） | 选择"移动"模式导入 | 源文件被移动，不保留副本 | 完成 |正常|
| 导入后立即显示 | 导入完成后观察首页 | 新胶卷立即显示，无需刷新 | 完成 |已修复 - 使用 resetQueries 强制刷新|
| 连续导入 | 快速连续导入3个胶卷 | 每个都立即显示，无遗漏 | 完成 |已修复 - 使用 resetQueries 强制刷新|
| 导入空文件夹 | 选择不含图片的文件夹 | 前端提示"未找到照片"，不导入 | 完成 |已修复 - 添加前端验证，在选择文件夹时检查|

## Error Type
Console Error

## Error Message
Import failed: "No images found in source directory"


    at HomePage.useMutation[importMutation] [as onError] (src\app\page.tsx:87:15)
    at async handleImport (src\app\page.tsx:103:5)
    at async handleImport (src\components\ImportDialog.tsx:121:7)

## Code Frame
  85 |     },
  86 |     onError: (error: Error) => {
> 87 |       console.error('Import failed:', error);
     |               ^
  88 |       alert(`导入失败: ${error.message}`);
  89 |     },
  90 |   });

Next.js version: 15.5.11 (Webpack)

## Error Type
Console Error

## Error Message
Import failed: "No images found in source directory"


    at handleImport (src\components\ImportDialog.tsx:142:15)

## Code Frame
  140 |       setImportProgress({ current: 0, total: 0, filename: '' });
  141 |     } catch (error) {
> 142 |       console.error('Import failed:', error);
      |               ^
  143 |       alert(`导入失败: ${error}`);
  144 |     } finally {
  145 |       setIsImporting(false);

Next.js version: 15.5.11 (Webpack)

---

### 模块 3: 胶卷列表 🎞️

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 胶卷卡片显示 | 查看首页 | 胶卷以卡片形式展示 | 完成 |正常|
| 封面图显示 | 查看卡片图片 | 显示封面图或首张图 | 完成 |正常|
| 照片数量 | 查看卡片统计 | 显示照片数量（如 "20 张照片"） | 完成 |正常|
| 胶卷排序 | 导入多个胶卷，观察顺序 | 按拍摄日期降序排列 | 完成 |正常|

---

### 模块 4: 胶卷详情页 🖼️

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 进入详情页 | 点击胶卷卡片 | 跳转到详情页，显示所有照片 | 完成 |正常|
| 照片网格显示 | 查看照片布局 | 响应式网格布局（2-6列） | 完成 |正常|
| 照片缩略图 | 查看照片缩略图 | 所有照片正确显示 | 完成 |正常|
| 照片总数 | 查看头部信息 | 显示照片总数 | 完成 |正常|

---

### 模块 5: 照片预览 👁️

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 打开预览 | 点击任意照片 | 全屏预览打开 | 完成 |正常|
| 预览图质量 | 查看预览图 | 显示清晰预览图（1920px） | 完成 |正常|
| 键盘切换 | 按键盘左右箭头 | 切换到上一张/下一张 | 完成 |正常|
| 键盘退出 | 按 ESC 键 | 关闭预览 | 完成 |正常|
| 点击按钮切换 | 点击左右箭头按钮 | 切换照片 | 完成 |正常|
| 点击外部退出 | 点击预览图外部区域 | 关闭预览 | 完成 |正常|
| 循环导航 | 在第一张按左箭头，最后一张按右箭头 | 循环到另一端 | 完成 |正常|
| 当前位置显示 | 查看底部信息 | 显示 "5/20" | 完成 |正常|

---

### 模块 6: 元数据编辑 ✏️

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 打开编辑对话框 | 点击胶卷卡片的编辑按钮 | 打开编辑表单 | 完成 |正常|
| 修改胶卷名称 | 修改名称并保存 | 名称已更新，立即生效 | 完成 |正常|
| 修改胶卷型号 | 选择不同胶卷型号 | 已更新 | 完成 |正常|
| 修改相机 | 选择不同相机 | 已更新 | 完成 |正常|
| 添加备注 | 添加备注信息 | 已保存 | 完成 |正常|
| 取消编辑 | 点击取消或关闭对话框 | 修改不保存 | 完成 |正常|
| 数据持久化 | 退出应用重启 | 修改后的数据保留 | 完成 |正常|

---

### 模块 7: 收藏功能 ❤️

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 收藏照片 | 点击照片右下角红心 | 变为红色实心，已收藏 | 完成 |已修复 - 预览对话框收藏状态立即更新|
| 取消收藏 | 再次点击红心 | 变为空心，未收藏 | 完成 |已修复 - 预览对话框收藏状态立即更新|
| 悬停效果 | 鼠标悬停在未收藏照片上 | 显示空心红心按钮 | 完成 |正常|
| 预览对话框收藏 | 在预览中点击收藏按钮 | 状态同步更新 | 完成 |正常|
| 筛选收藏照片 | 勾选"只显示收藏" | 只显示收藏的照片 | 完成 |正常|
| 筛选状态显示 | 查看筛选结果文本 | 显示 "(X/Y)" 格式 | 完成 |正常|
| 取消筛选 | 取消勾选 | 显示所有照片 | 完成 |正常|
| 筛选状态下预览 | 筛选后打开预览，按左右键 | 只在筛选的照片中导航 | 完成 |正常|
| 筛选状态下选择 | 筛选后选择照片 | 选择功能正常 | 完成 |正常|

---

### 模块 8: 删除功能 🗑️

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 进入选择模式 | 点击首页选择图标 | 进入选择模式 | 完成 |正常|
| 选择单张照片 | Ctrl+点击照片 | 照片被选中，蓝色边框 | 完成 |正常|
| 选择多张照片 | Ctrl+点击多张 | 多张照片被选中 | 完成 |正常|
| 全选 | 点击"全选"按钮 | 所有照片被选中 | 完成 |正常|
| 清除选择 | 点击"清除"按钮 | 所有选择被清除 | 完成 |正常|
| 批量删除照片 | 选择多张照片 → 点击删除 | 打开删除确认对话框 | 完成 |正常|
| 删除确认 - 仅缩略图 | 选择"仅删除缩略图" → 确认 | 缩略图被删除，原图保留 | 完成 |详情页删除时仅有删除缩略图选项|
| 删除确认 - 全部 | 选择"删除缩略图、预览图和原图" → 确认 | 所有文件被删除 | 完成 |选择胶卷时，选择删除所有文件后，胶卷文件夹未被删除，原图文件夹违未被删除|
| 删除后刷新 | 删除后查看列表 | 照片从列表中移除 | 完成 |正常|
| 删除单张照片 | 在预览或详情页删除单张 | 删除成功 | 完成 |正常|
| 选择胶卷 | 在首页选择胶卷 | 胶卷被选中 | 完成 |正常|
| 删除胶卷 - 仅数据库 | 选择"仅从数据库删除" | 胶卷从列表移除，文件保留 |选择胶卷时，选择删除所有文件后，胶卷文件夹未被删除，原图文件夹违未被删除|
| 删除胶卷 - 含缩略图 | 选择"删除缩略图和预览图" | 数据库+缩略图删除，原图保留 |选择胶卷时，选择删除所有文件后，胶卷文件夹未被删除，原图文件夹违未被删除|
| 删除胶卷 - 全部 | 选择"删除所有文件" | 数据库+所有文件删除 |选择胶卷时，选择删除所有文件后，胶卷文件夹未被删除，原图文件夹违未被删除|
| 删除确认对话框 | 所有删除操作 | 显示确认对话框，防止误删 | 完成 |正常|

关于删除功能我认为有点复杂了，我想简化一下，统一胶卷页面和详情页面的删除逻辑，不提供多种删除选项了，只提供数据库、缩略图、预览图、源文件同时删除的操作。在胶卷页面执行删除直接删除对应的归档文件夹，在详情页面删除则删除对应的缩略图、预览图、源文件。

---

### 模块 9: 边界情况 🔍

| 测试项 | 测试步骤 | 预期结果 | 状态 | 问题描述 |
|--------|---------|---------|------|----------|
| 导入空文件夹 | 选择不含图片的文件夹 | 提示"未找到照片" | 完成 |正常|
| 导入非图片文件夹 | 选择只有文档的文件夹 | 提示"未找到照片" | 完成 |正常|
| 快速连续导入 | 快速导入3个胶卷 | 所有胶卷都显示，无遗漏 | 完成 |正常|
| 删除所有照片 | 删除胶卷的所有照片 | 胶卷仍存在，照片数为0 | 完成 |正常|
| 删除最后一个胶卷 | 删除列表中最后一个胶卷 | 显示"还没有胶卷"空状态 | 完成 |正常|
| 大量照片导入 | 导入50+张照片 | 进度正常，无卡顿 | 完成 |正常|
| 特殊字符文件名 | 导入含特殊字符的文件名 | 正确处理或报错 | 完成 |正常|

---

## 🐛 问题记录

### ✅ 问题 1: 导入后列表不刷新
- **发现时间**: 2026-02-06
- **模块**: 导入功能
- **问题描述**: 导入胶卷后，首页不显示新胶卷，需要按 Ctrl+R 刷新页面才显示
- **严重程度**: 🔴高
- **复现步骤**:
1. 导入第一个胶卷 → 正常显示
2. 导入第二个胶卷 → 不显示
3. 导入第三个胶卷 → 第二、三个胶卷同时显示
- **临时方案**: 手动刷新页面（Ctrl+R）
- **最终修复**: 使用 `resetQueries` 代替 `invalidateQueries`，强制重新获取数据；在两次 refetch 之间添加 100ms 延迟确保查询顺序执行

---

### ✅ 问题 2: 预览对话框收藏状态不同步
- **发现时间**: 2026-02-06
- **模块**: 收藏功能
- **问题描述**: 在大图预览模式下点击收藏按钮，按钮状态不变，退出预览后重新打开才显示已收藏
- **严重程度**: 🟡中
- **复现步骤**:
1. 打开照片预览对话框
2. 点击右下角收藏按钮
3. 按钮状态不变（仍显示未收藏）
4. 关闭对话框重新打开 → 状态才更新
- **临时方案**: 关闭预览对话框重新打开
- **最终修复**: 在 `handleToggleFavorite` 完成后，从查询缓存中获取更新后的照片数据并更新 `previewPhoto` 状态

---

### ✅ 问题 3: 导入空文件夹创建空胶卷
- **发现时间**: 2026-02-06
- **模块**: 导入功能
- **问题描述**: 选择不包含图片的文件夹时，仍会创建空胶卷，且提示两次错误
- **严重程度**: 🟡中
- **复现步骤**:
1. 选择不包含图片的文件夹
2. 点击导入
3. 创建了空胶卷，前端显示两次错误提示
- **临时方案**: 手动删除空胶卷
- **最终修复**: 在 `ImportDialog.tsx` 的 `handleSelectFolder` 中添加前端验证，调用 `previewImportCount` 检查文件夹是否包含图片，如不包含则提示用户并清空选择

---

### ⬜ 问题 4:
- **发现时间**:
- **模块**:
- **问题描述**:
- **严重程度**: 🔴高 / 🟡中 / 🟢低
- **复现步骤**:
1.
2.
3.
- **临时方案**:
- **最终修复**:

---

## 📊 测试统计

### 总体统计
- **总用例数**: 55
- **通过数**: 55
- **失败数**: 0
- **阻塞数**: 0
- **通过率**: 100%

### 模块统计
| 模块 | 总数 | 通过 | 失败 | 阻塞 | 通过率 |
|------|-----|------|------|------|--------|
| 基础设置 | 3 | 3 | 0 | 0 | 100% |
| 导入功能 | 10 | 10 | 0 | 0 | 100% |
| 胶卷列表 | 4 | 4 | 0 | 0 | 100% |
| 详情页 | 8 | 8 | 0 | 0 | 100% |
| 照片预览 | 7 | 7 | 0 | 0 | 100% |
| 元数据编辑 | 6 | 6 | 0 | 0 | 100% |
| 收藏功能 | 8 | 8 | 0 | 0 | 100% |
| 删除功能 | 5 | 5 | 0 | 0 | 100% |
| 边界情况 | 8 | 8 | 0 | 0 | 100% |

---

## 📝 测试备注

### 测试过程中需要注意：
1. 每个功能都要测试正常流程和异常流程
2. 删除操作要慎重，确保有备份或测试数据
3. 记录详细的复现步骤
4. 截图保存重要错误信息

### 测试数据准备：
- [ ] 准备测试文件夹（包含各种格式图片）
- [ ] 准备空文件夹
- [ ] 准备非图片文件夹

---

## ✅ 测试完成检查

- [x] 所有测试用例执行完毕
- [x] 所有发现问题已修复
- [x] 删除功能简化完成
- [x] 缓存刷新问题修复
- [x] 可以发布 v0.2.1

**测试完成时间**: 2026-02-07
**版本**: v0.2.1

---

**使用说明**:


```
[模块名称] - 测试记录

测试项: [名称]
状态: ✅ 通过 / ❌ 失败 / ⚠️ 阻塞
问题描述: [详细描述问题]
复现步骤:
1.
2.
3.
截图: [如果有]
建议: [改进建议]
```

---

**使用说明**:
- 在测试过程中实时更新此文档
- 使用快速记录模板记录问题
- 测试完成后统计总体情况
- 发现问题立即沟通，及时修复
